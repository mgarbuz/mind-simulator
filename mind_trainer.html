<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title></title>
    <style type='text/css'>
            #test{
                display:none;
            }
            #circle_red {
      width: 50px;
      height: 50px;
      -webkit-border-radius: 25px;
      -moz-border-radius: 25px;
      border-radius: 25px;
      background: red;
    }
      #circle_yellow {
      width: 50px;
      height: 50px;
      -webkit-border-radius: 25px;
      -moz-border-radius: 25px;
      border-radius: 25px;
      background: yellow;
    }
      #circle_green {
      width: 50px;
      height: 50px;
      -webkit-border-radius: 25px;
      -moz-border-radius: 25px;
      border-radius: 25px;
      background: green;
    }
      #circle_grey {
      width: 50px;
      height: 50px;
      -webkit-border-radius: 25px;
      -moz-border-radius: 25px;
      border-radius: 25px;
      background: grey;
    }
    </style>

</head>
<body>

<h1>
    <time>00:00:00</time>
</h1>
<div id="main_panel"/>
<button id="strt">start</button>
<button id="agn">again</button>
<button id="nxt">next</button>
<button id="chk">check</button>


<canvas id="myCanvas" width="700" height="200">
    Ваш браузер не поддерживает Canvas
</canvas>

<script type='text/javascript'>




            const color= ['red','green','yellow'];
            var image = document.getElementById("myCanvas");
            var randoms = Array.from({length: 20}, () => Math.floor(Math.random() * 3));
            var p = 0;

            var i = 0, s = ["block","none"], t = [2000,1000]; //2 сек есть картинка, 1 сек нет
            var count = 0;
            var canvas = document.getElementById("myCanvas"), 
            context = canvas.getContext('2d');
            
            function switchColor(number) {
               var str_res = "";
               var color = document.getElementById('data_' + number).innerHTML;
               var r = color;
               if(r == 0) str_res += "<div id=\"circle_red\"></div>";
               if(r == 1) str_res += "<div id=\"circle_yellow\"></div>";
               if(r == 2) str_res += "<div id=\"circle_green\"></div>";
               color++;
               document.getElementById("data_" + number).innerHTML=color%3;
               document.getElementById("circle_" + number).innerHTML = str_res;
        }


            window.onload = function(){

            var h1 = document.getElementsByTagName('h1')[0];
            var start = document.getElementById('strt');
            var next = document.getElementById('nxt');
            var check = document.getElementById('chk');
            var again = document.getElementById('agn');
            var milisec = 0;
            var sec = 0;
            var min = 0;
            var time;
            
            function clearTime() {
                   milisec = 0; sec = 0; min = 0;
            }

            function tick(){
		    milisec+=10;
		    if (milisec >= 100) {
			    milisec = 0;
			    sec++;
			    if (sec >= 60) {
				    sec = 0;
				    min++;
			    }
		    }
            }

            function add() {
		    tick();
		    h1.textContent = (min > 9 ? min : "0" + min) 
		    + ":" + (sec > 9 ? sec : "0" + sec)
		    + ":" + (milisec > 9 ? milisec : "0" + milisec);
		    timer();
            }

            function timer() {
            	time = setTimeout(add, 100);
            }

            //timer();
            //show();
            start.onclick = function() {
		    timer();
		    show();
            }

            check.onclick = function() {
            	clearTimeout(time);
               document.getElementById("main_panel").innerHTML=generateTable();
            }

            reset.onclick = function() {
		    h1.textContent = "00:00:00";
		    seconds = 0; milisec = 0; min = 0;
            }
            again.onclick = function() {
		    p=0;
		    count=0;
		    i=0;
		    show();
            }













            function drawCircle(i, j, k, l , color) {
                   context.beginPath();
		    context.arc(i, j, k, l, Math.PI*2, false);
		    context.closePath();
		    context.stroke();
		    context.fillStyle = color;
		    context.fill();
            }

            function show()
            { 
		    i ^= 1
		    if(i == 0) {
		    	p += 3;
		    }
		    image.style.display = s[i];
		    
		    if (count < 10) {
			count += 1;
			setTimeout(show,t[i]);
		    } else {
			phase2();
			//timer();
		    }

                   drawCircle(60, 90, 50, 0, color[randoms[p]]);
                   drawCircle(200, 90, 50, 0, color[randoms[p+1]]);
                   drawCircle(350, 90, 50, 0, color[randoms[p+2]]);
            }

	     function phase2() {
                   clearTime();
                   setTimeout(phase3, 6000);
	     }
             
             function phase3() {
                   clearTimeout(time);
                   drawCircle(60, 90, 50, 0, color[randoms[p]]);
                   drawCircle(200, 90, 50, 0, color[randoms[p+1]]);
                   drawCircle(350, 90, 50, 0, color[randoms[p+2]]);
                   drawCircle(500, 90, 50, 0, color[randoms[p+3]]);
                   drawCircle(650, 90, 50, 0, color[randoms[p+4]]);
                   image.style.display = "block";
             }

            //show()

            function generateTable() {
               var result = "<table>" 
                            + generateRow(0)
                            + generateRow(5)
                            + generateRow(10)
                            + generateRow(15)
                            + "</table>";
               return result;
        }
        function generateRow(row) {
               var result = "<tr>" 
                          + generateCell(row+0) + generateCell(row+1) + generateCell(row+2) + generateCell(row+3) + generateCell(row+4)
			   + "</tr>";
               return result;
        }
        function generateCell(id) {
               var result = "<th id=\""+id + "\" onclick=\"switchColor('" + id + "')\">\
                   <div id=\"data_" + id + "\" style=\"display:none\">" + 0 + "</div>\
                   <div id=\"circle_" + id + "\">\
                        <div id=\"circle_grey\"></div>\
                   </div>\
               </th>";
               return result;
        }

            }					

</script>
</body>
</html>
